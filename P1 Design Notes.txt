Project 1: Design and Notes | Due Week 5 - February 2nd
Objective: Create a database that tracks the creation of and transaction history of Apple products across the world.
		   Maintain the data for Apple and make sure every ascpect of business is recorded well and can be tracked.
-----------------------------------------------------------------------------		   
Product Flow
-----------------------------------------------------------------------------
Production House => Warehouse => Distributor => Sub Distributor => Channel Partner => Zone => Store => Customer

Continent -> 3 Production Houses

Country -> 4 Warehouses
		-> 1 General Distributor
		-> Many Sub Distributors
		
Channel Partner -> Many Zones
				-> Many Stores
-----------------------------------------------------------------------------				
Price Increase
-----------------------------------------------------------------------------
Production House -> Warehouse : No Price Increase
Warehouse -> General Distributor : 8% Price Increase
General Distributor -> Sub Distributor : 8% Price Increase
Sub Distributor -> Channel Partner : 8% Price Increase
Channel Partner -> Store: 8% Price Increase
Store -> Customer : 8% Price Increase

From Production to Customer, there is a 40% total price increase.
-----------------------------------------------------------------------------
Customer Data
-----------------------------------------------------------------------------
When a sale is made at the Store level, data is gathered about Customers.

Unique ID: SSN, Passport No, Citizen ID No, etc.
Name: First and Last
Phone Number: (xxx)xxx-xxxx
Email Address
Street
City
State(if applicable)
Zip Code
Country

-----------------------------------------------------------------------------
Entities
-----------------------------------------------------------------------------
ProductList
	-productId
	-productName
	-productType
	-productCategory
	-basePrice
Continent
	-continentId
	-continentName
Country
	-countryId
	-countryName
	-continentId
ProductionHouse
	-productionHouseId
	-continentId
Warehouse
	-warehouseID
	-countryId
ProductionInventory
	-serialNumber
	-productId
	-warehouseId
ProductionLog
	-productionLogId
	-productionHouseId
	-productId
	-serialNumber
	-dateOfProduction
GeneralDistributor
	-generalDistributorId
	-countryId
GeneralInventory
	-serialNumber
	-productId
	-generalDistributorId
	-price
GeneralDistributorPurchases
	-purchaseId
	-generalDistributorId
	-warehouseId
	-serialNumber
	-dateOfPurchase
SubDistributor
	-subDistributorId
	-generalDistributorId
SubDistributorInventory
	-serialNumber
	-productId
	-subDistributorId
	-price
SubDistributorPurchases
	-purchaseId
	-subDistributorId
	-generalDistributorId
	-serialNumber
	-dateOfPurchase
Channel Partner
	-channelPartnerId
	-subDistributorId
Zone
	-zoneId
	-channelPartnerId
Store
	-storeId
	-zoneId
StoreInventory
	-serialNumber
	-storeId
	-price
ChannelZoneStoreTransactions
	-transactionId
	-channelPartnerId
	-zoneId
	-storeId
	-serialnumber
	-dateOfTransaction
StoreTransactions
	-transactionId
	-storeId
	-customerId
	-serialnumber
	-dateOfTransaction
Customer
	-CustomerID
	-FirstName
	-LastName
	-Phone Number
	-Email
	-City
	-Country

-----------------------------------------------------------------------------
Views
-----------------------------------------------------------------------------
create view ProductionHouseLocations as
select ProductionHouse.productionHouseId as [Production House], Country.countryName as [Country], Continent.continentName as [Continent]
from ProductionHouse
join Country on ProductionHouse.countryId = Country.countryId
join Continent on Country.continentId = Continent.continentId

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

create view DisplayProductionLog as
select ProductionLog.productionLogId as [Log Number],
		ProductionLog.productionHouseId as [Production House],
		ProductionInventory.warehouseId as [Warehouse Number],
		ProductionLog.productId as [Item Number],
		ProductionLog.serialNumber as [Serial Number],
		ProductionLog.dateOfProduction as [Date Produced]
from ProductionLog
join ProductionInventory on ProductionLog.serialNumber = ProductionInventory.serialNumber;

-----------------------------------------------------------------------------
Procedures
-----------------------------------------------------------------------------
create procedure proc_InitializeWarehouse
as
	declare @count int
	declare @totalCountries int
	declare @numWarehouses int

	set @totalCountries = (select max(countryId) from Country)
	set @count = 0;
	

	while (@count < @totalCountries)
	begin
		set @numWarehouses = 0;
		set @count += 1
		while (@numWarehouses < 4)
		begin
			insert into Warehouse values(@count)
			set @numWarehouses += 1
		end
	end
	
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	

create procedure proc_GenerateProducts @productToProduce int
as
	declare @storageWarehouse int

	set @storageWarehouse = (select top 1 warehouseId from Warehouse order by newid())

	insert into ProductionInventory values(@productToProduce, @storageWarehouse)

	select * from ProductionInventory;
	
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	
create procedure proc_GenerateGeneralDistributors
as
	declare @totalCountries int
	declare @count int

	set @totalCountries = (select count(*) from Country);
	set @count = 0

	while (@count < @totalCountries)
	begin
		set @count += 1;
		insert into GeneralDistributor values(@count);
	end
	
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

create procedure proc_ProductionToGeneralDistributor @serialNumber bigint
as
	declare @warehouse int
	declare @country int
	declare @distributor int
	declare @productNum int
	declare @price money

	set @warehouse = (select warehouseId from ProductionInventory where serialNumber = @serialNumber)
	set @country = (select countryId from Warehouse where warehouseId = @warehouse)

	set @distributor = (select generalDistributorId from GeneralDistributor where countryId = @country)
	set @productNum = (select productId from ProductionInventory where serialNumber = @serialNumber);
	set @price = (select basePrice from ProductList where productId = @productNum) * 1.08

	insert into GeneralDistributorInventory values(@serialNumber, @productNum, @distributor, @price);

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

create procedure proc_GenerateSubDistributors
as
	declare @totalGenDistributors int
	declare @count int
	declare @numSubDistributor int
	declare @idNum int

	set @totalGenDistributors = (select count(*) from GeneralDistributor)
	set @count = 0
	set @idNum = 200

	while(@count < @totalGenDistributors)
	begin
		set @numSubDistributor = 0
		set @count += 1
		set @idNum += 1
		while(@numSubDistributor < 2)
		begin
			insert into SubDistributor values(@idNum)
			set @numSubDistributor += 1
		end
	end
	
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	
	
create procedure proc_GeneralDistributorToSubDistributor @serialNum bigint
as
	declare @generalDistributor int
	declare @subDistributor int
	declare @productNum int
	declare @price money

	set @generalDistributor = (select generalDistributorId from GeneralDistributorInventory where serialNumber = @serialNum)
	set @subDistributor = (select top 1 subDistributorId from SubDistributor where generalDistributorId = @generalDistributor order by newid())
	set @productNum = (select productId from ProductionLog where serialNumber = @serialnum)
	set @price = (select generalDistributorPrice from GeneralDistributorInventory where serialNumber = @serialNum) * 1.08

	insert into SubDistributorInventory values(@serialNum, @productNum, @subDistributor, @price)
	
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	

create procedure proc_GenerateChannelPartners
as
	declare @count int
	declare @totalSubDistributors int
	declare @numChannels int
	declare @idNum int

	set @totalSubDistributors = (select count(*) from SubDistributor)
	set @count = 0
	set @idNum = 300

	while(@count < @totalSubDistributors)
	begin
		set @numChannels = 0
		set @count += 1
		set @idNum += 1
		while(@numChannels < 3)
		begin
			insert into ChannelPartner values(@idNum)
			set @numChannels += 1
		end
	end

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

create procedure proc_GenerateZones
as
	declare @count int
	declare @totalChannels int
	declare @numZones int
	declare @idNum int

	set @totalChannels = (select count(*) from ChannelPartner)
	set @count = 0
	set @idNum = 399

	while(@count < @totalChannels)
	begin
		set @numZones = 0
		set @count += 1
		set @idNum += 1
		while(@numZones < 2)
		begin
			insert into Zone values(@idNum)
			set @numZones += 1
		end
	end
-----------------------------------------------------------------------------
Triggers
-----------------------------------------------------------------------------
create trigger trg_LogProductCreation
on ProductionInventory
after insert as
	declare @serialNum int
	declare @producedAt int
	declare @storedAt int
	declare @itemId int
	declare @continent char(2)

	set @serialNum = (SELECT TOP 1 serialNumber FROM ProductionInventory ORDER BY serialNumber DESC)
	set @itemId = (SELECT TOP 1 productId FROM ProductionInventory ORDER BY serialNumber DESC)
	set @storedAt = (SELECT TOP 1 warehouseId FROM ProductionInventory ORDER BY serialNumber DESC)

	set @storedAt = (select countryId from Warehouse where warehouseId = @storedAt) 
	set @continent = (select continentId from Country where countryId = @storedAt)
	set @producedAt = (select top 1 productionHouseId from ProductionHouse where continentId = @continent order by newid())

	insert into ProductionLog values(@producedAt, @itemId, @serialNum, getdate());
	
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

create trigger trg_LogGeneralDistributorPurchase
on GeneralDistributorInventory
after insert as
	declare @serialNum int
	declare @generalDistributor int
	declare @warehouse int

	set @serialNum = (SELECT TOP 1 serialNumber FROM GeneralDistributorInventory ORDER BY serialNumber DESC)
	set @generalDistributor = (select generalDistributorId from GeneralDistributorInventory where serialNumber = @serialNum)
	set @warehouse = (select warehouseId from ProductionInventory where serialNumber = @serialNum)

	insert into GeneralDistributorPurchases values(@generalDistributor, @warehouse, @serialNum, getdate())
	delete from ProductionInventory where serialnumber = @serialNum
	
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

create trigger trg_LogSubDistributorPurchase
on SubDistributorInventory
after insert as
	declare @serialNum bigint
	declare @subDistributor int
	declare @generalDistributor int

	set @serialNum = (SELECT TOP 1 serialNumber FROM SubDistributorInventory ORDER BY serialNumber DESC)
	set @subDistributor = (select subDistributorId from SubDistributorInventory where serialNumber = @serialNum)
	set @generalDistributor = (select generalDistributorId from GeneralDistributorInventory where serialNumber = @serialNum)

	insert into SubDistributorPurchases values(@subDistributor, @generalDistributor,@serialNum, getdate());
	delete from GeneralDistributorInventory where serialNumber = @serialNum